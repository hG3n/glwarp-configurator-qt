# GLwarp Configurator
Glwarp configurator is a software toolkit aimed to create transformation datasets for fulldome configurations using a single projector and a spherical mirror.

## Setup
The Software was tested using Qt-Versions 5.8, 5.9, 5.10. Simply add the project to QtCreator and configure for either of the mentioned versions.

## UI-Configuration
Glwarp-Configurators user interfaces is generated by parsing a single ui.json file. This is parsed on starting the application and will create the specified UI-elements in the sidebar as long as the configuration format is used accordingly.

## Documentation
A documentation generated using doxygen is available within the `docs` subfolder. However, just browsing the code would give a way more detailed insight on the architecture and where to start if the tool should be extended.

### Format
A user interface configuraion file has the following basic layout, starting off with a <string> specifying the Confirm buttons label, as well as an array containing groups of ui elements to be created.
 
```
{
  "confirm_message" : "Recalculate",
  "ui" : [...]
}
```
 
Each major group gets a title as well as a key attribute matching the key specified within the respective model configuration. The key is important for the main application to build a correspondence between user interface and model configuraion. Furthermore, to-be-created ui groups are given as attributes of a json object. This is done in order to maintain the order of groups specified in the json file within the application.  

```
{
  "title": "Projector",
  "attribute": "projector",
  "groups": { ... },
}
```
 
Groups are specified by simple creating a named json object. Containing a title, again another key to identify the attribute it changes. Important is, that the objects name as well as the string inclueded within the 'attrbute' field MUST match. Finally each group contains an array which specifies the amount of values to be captured. For each element of the 'elements' array, the applicaion will create a simple QSpinbox.
 
 ```
{
  "position": {
    "title": "Position",
    "attribute" : "position",
    "elements" : [...],
  }
}
 ```
 
Each Element to be created needs several attributes in order to function properly.  First the Spinboxes title, as well as the attribute it captures. In addition to that the minimum, maximum and the precision need to be specified
 
 ```
 {
     "title": "X",
     "attribute": "x",
     "precision": 0.01,
     "min": -2.0,
     "max": 2.0
 },
```

The already provided ui.json file contains the maximum configurable amount of values to this point. Because of the structure it should be an easy task to extend the interfaces as well as the funcitonality.

## Values
All values fed into the system must be in metric units (m) reflecting the real world setup. However, since the implemented DomeProjector class only abstracts the real life setup minor drifts between software representation and real world setup are just a logic consequence.
Results calculated from the configurator do represent the actual geometry that should be used for an exact projection. The final production warping software is capable of altering the position and rotation of the mesh, allowing for more accurate setups.

## Workflow
Once all real world parameters have been measured the applicaiton features very simple intearctions to be followed. In order to resimulate the current specified setup a menu action ___Edit > Run Simulation___ has been added in addition to the Recalculate button on the lower end of the sidebar. Furthermore the shortcut ___CTRL+R___ on Linux and Windows as well as ___CMD+R___ on Mac were implemented.

It is suggested to first simulate values with a low Output resolution (4x16, 8x32, depending on the utilized hardware) as well as a lower sample point count (64x64 or 128x128). These values are sufficient to first test the specified values using the [glwarp] (https://github.com/hG3n/glwarp)  tool. If these values appear to be good the resolutions can be increased. However, note that a very high output resolution can lead to a dropping framerate in glwarp, since more texture information have to be processed. For a final dataset in the dome environment this tool was developed for a sample resolution of 512x512 was accurate enough to create an accurate transformation mesh.

Functionality to save and load the config as well as a final set of transformations are also available as ___File___ actions.

The three dimensional output simply utilizes `GL_POINT`'s for a performant display of raycasted points. The coordinate systems origin is visualized using four of those. Every other geometry is only visible if all needed elements are aligned the proper way. A representation of the final geometrys appearance is placed directly over the origin in yellow. A rotation of the visualization around the origin can be applied simply by dragging the view.

All these elements can be changed within the `GlWidget`'s class function `paintGL` 
